<!DOCTYPE html>
<html lang="en">
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Event Map</title>

<script src="https://unpkg.com/html5-qrcode"></script>

<style>
body {
  font-family: Arial, sans-serif;
  background: #f4f4f4;
  margin: 0;
  padding: 20px;
}

h2 {
  text-align: center;
}

#map {
  position: relative;
  max-width: 420px;
  margin: 20px auto;

  background: #fdfdfd;
  border: 4px solid #000;
  border-radius: 16px;
  padding: 20px;
  height: 420px;
}

.station {
  position: absolute;
  width: 140px;
  height: 80px;

  background: #ffffff;
  border: 3px dashed #333;
  border-radius: 12px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  font-size: 16px;
  cursor: pointer;
  user-select: none;
  box-shadow: 0 4px 8px rgba(0,0,0,0.1);
}

.station.active {
  background: #dff5ff;
}

.star {
  position: absolute;
  top: 6px;
  right: 8px;
  display: none;
}

/* Station positions (ROUGH, adjustable later) */
#OLED { top: 20px; left: 20px; }
#ULTRA { top: 20px; right: 20px; }
#QNED { bottom: 20px; left: 20px; }
#MRGB { bottom: 20px; right: 20px; }

/* Scanner modal */
#scannerModal {
  display: none;
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.8);
  z-index: 1000;
}

#reader {
  width: 100%;
  max-width: 420px;
  margin: 40px auto;
}

#closeBtn {
Â  display: block;
Â  margin: 10px auto;
Â  padding: 10px 20px;
}

.completed {
position: fixed; 
inset: 0;
background: rgba(0,0,0,0.85);
display: flex;
align-items: center;
justify-content: center;
z-index: 999;
}

.hidden {
display: none;
}

.pass-card {
position: relative;
max-width: 320px;
background: #fff;
border-radius: 16px;
padding: 24px 28px;
text-align: center;
width: 90%;
}

.pass-card h2 {
margin: 0 0 8px;
}

.close-btn {
position: absolute;
top: 10px;
right: 12px;
border: none;
background: transparent;
font-size: 22px;
cursor: pointer;
}

.timestamp {
margin: 12px 0;
color: #555;
font-size: 14px;
}

.note {
margin-top: 16px;
font-size: 14px;
}

.redeem-btn {
margin-top: 18px;
padding: 12px;
width: 100%;
border: none;
border-radius: 10px;
background: #d32f2f;
color: #fff;
font-size: 15px;
font-weight: bold;
}

.pass-pulse {
position: absolute;
inset: -6px;
border-radius: 20px;
border: 2px solid #4CAF50;
animation: pulse 2s infinite;
pointer-events: none;
}

@keyframes pulse {
0% { opacity: 0.2; }
50% { opacity: 0.6; }
100% { opacity: 0.2; }
}
  
.redeem {
position: absolute;
bottom: 60%;
left: 70%;
transform: translate(-50%, 50%);
border: 3px solid #ff9800;
background: #fff3cd;
display: none;
}
  
.redeem.pulse {
animation: pulseRedeem 1.8s infinite;
}

@keyframes pulseRedeem {
0% { box-shadow: 0 0 0 0 rgba(255,152,0,0.6); }
70% { box-shadow: 0 0 0 16px rgba(255,152,0,0); }
100% { box-shadow: 0 0 0 0 rgba(255,152,0,0); }
}

</style>
</head>

<body>

<h2>Event Stations</h2>
<p style="text-align:center">
Complete all stations to redeem a prize
</p>

<div id="map">
Â  <div class="station" id="OLED" onclick="openScanner()">
Â  Â  OLED
Â  Â  <span class="star" id="star-OLED">â­</span>
Â  </div>

Â  <div class="station" id="ULTRA" onclick="openScanner()">
Â  Â  ULTRA
Â  Â  <span class="star" id="star-ULTRA">â­</span>
Â  </div>

Â  <div class="station" id="QNED" onclick="openScanner()">
Â  Â  QNED
Â  Â  <span class="star" id="star-QNED">â­</span>
Â  </div>

Â  <div class="station" id="MRGB" onclick="openScanner()">
Â  Â  MRGB
Â  Â  <span class="star" id="star-MRGB">â­</span>
Â  </div>

Â  <div class="station redeem" id="REDEEM" onclick="openRedeemPass()">
Â  Â  ğŸ Redeem your prize here ğŸ
Â  </div>
</div>

<button id="showPassBtn" style="display:none;" onclick="showCompletedPass()"> 
Show Completed Pass
</button>

<div id="completedPass" class="completed hidden">
Â  <div class="pass-card">
<button id="closePassBtn" class="close-btn">X</button>
Â  Â  <h2>ğŸ‰ Pass Completed!</h2>
Â  Â  <p>All stations cleared</p>

Â  Â  <div class="timestamp" id="passTime"></div>

Â  Â  <p class="note">
Â  Â  Â  Show this screen to staff to redeem<br>
Â  Â  Â  <strong>1 scratch card</strong><br>
      Good Luck!
Â  Â  </p>
    <button id="redeemBtn" class="redeem-btn" onclick="openScanner()">
Scan QR code to exchange for your scratch card
</button>

Â  Â  <div class="pass-pulse"></div>
Â  </div>
</div>

<div id="redeemedOverlay" class="completed hidden">
Â  <div class="pass-card">
Â  Â  <h2>âŒ Pass Used</h2>
Â  Â  <p>Token has been redeemed.</p>

Â  Â  <div class="timestamp" id="redeemedTime"></div>

Â  Â  <p class="note">
Â  Â  Â  
Â  Â  </p>
  
Â  Â  <div class="pulse"></div>
Â  </div>
</div>


<div id="scannerModal">
Â  <div id="reader"></div>
Â  <button id="closeScannerBtn" onclick="closeScanner()">Cancel</button>
</div>


<script>
let DEV_MODE = true;
if (DEV_MODE) resetDevProgress() 
let STATIONS = ["OLED", "QNED", "ULTRA", "MRGB"]
let scanner;
let timeInterval = null;

const STATION_MAP = {
"qJZ1eCxQ": "OLED",
"sve4h4LW": "QNED",
"SRC7LsY7": "ULTRA LARGE",
"10k7CBA9": "MRGB"
}
// R: N0Uf9B3D for redemption


window.addEventListener("load", () => {
updateStars()
document.getElementById("redeemBtn").addEventListener("click", onRedeem);
document.getElementById("closePassBtn").addEventListener("click", hideCompletedPass);

let p = loadProgress()
if (p.redeemed) {
showRedeemed()
} else if (allStationsCompleted()) {
showRedemptionBooth()
}
})





// TESTING
function resetDevProgress() {
let clean = {
OLED: true,
QNED: true,
ULTRA: true,
MRGB: false,
redeemed: false
}
localStorage.setItem("eventProgress", JSON.stringify(clean))
console.log("DEV_MODE: progress reset", clean)
}




// CAMERA
async function openScanner() {
Â  document.getElementById("scannerModal").style.display = "block";

Â  if (!scanner) {
Â  Â  scanner = new Html5Qrcode("reader");
Â  }

try {
await scanner.start(
Â  Â  { facingMode: "environment" },
Â  Â  { fps: 6, qrbox: 260, disableFlip: true },
Â  Â  onScan
Â  );
} catch(err) {
console.error("Camera start failed", err);
}
}

function closeScanner() {
Â  document.getElementById("scannerModal").style.display = "none";
Â  scanner?.stop().catch(() => {});
}

function onScan(text) {
// STATION QR
Â  if (text.startsWith("S:")) {
let key = text.substring(2)
Â  const stationId = STATION_MAP[key]

if (!stationId) return

Â  const p = loadProgress();
Â  p[stationId] = true;
Â  saveProgress(p);

Â  updateStars();

if (allStationsCompleted()) {
  let p = loadProgess()
  if (!p.completedAt) {
    p.completedAt = new Date().toLocaleString()
    saveProgress(p)
  }
showRedemptionBooth()
}

Â  closeScanner(); 
return
}
  
// REDEEM QR
if (text == "R:N0Uf9B3D") {
  closeScanner()
let p = loadProgress()

if (!allStationsCompleted()) { 
alert("Pass incomplete. Please finish all stations.")
return
}
if (p.redeemed) return
p.redeemed = true
p.redeemedAt = new Date().toLocaleString()
saveProgress(p)
showRedeemed()
return 
}}



updateStars();


// CHECK STATUS
function loadProgress() {
Â  return JSON.parse(localStorage.getItem("eventProgress") || "{}");
}

function saveProgress(p) {
Â  localStorage.setItem("eventProgress", JSON.stringify(p));
}

function updateStars() {
Â  const p = loadProgress();
Â  STATIONS.forEach(id => {
Â  Â  const star = document.getElementById("star-" + id);
    if (!star) return;

Â  Â  star.style.display = p[id] == true ? "inline" : "none";
Â  });
}

function allStationsCompleted() {
let p = loadProgress();
return STATIONS.every(id => p[id] == true);
}


// COMPLETED PASS/REDEEM PASS
function showCompletedPass() {
let pass = document.getElementById("completedPass")
let timeEl = document.getElementById("passTime")

pass.classList.remove("hidden")

let p = loadProgress()
 if (p.completedAt) {
    tiemEl.textContent = "Completed at: " + p.completedAt
 } else {
   timeEl.textContent = ""
  }
}

function hideCompletedPass() {
document.getElementById("completedPass").classList.add("hidden")
  clearInterval(timeInterval);
}

function onRedeem() {
let confirmRedeem = confirm("Confirm redemption?\nThe pass will become invalid.")
if (!confirmRedeem) return

// localStorage.removeItem("eventProgress")

let p = loadProgress()
p.redeemed = true
p.redeemedAt = new Date().toLocaleString()
saveProgress(p)

document.getElementById("completedPass").classList.add("hidden")
showRedeemed()
}

function showRedeemed() {
let pass = document.getElementById("redeemedOverlay")
let timeEl = document.getElementById("redeemedTime")

pass.classList.remove("hidden")
let p = loadProgress()
if (p.redeemedAt) {
timeEl.textContent = "Redeemed at: " + new Date(p.redeemedAt).toLocaleString() 
}}

function showRedemptionBooth() {
let booth = document.getElementById("REDEEM") 
booth.style.display = "flex"
booth.classList.add("redeem-pulse")
}

function openRedeemPass() {
showCompletedPass()
}

function updateShowPassButton() {
let p = loadProgress()
document.getElementById("showPassBtn").style.display = 
allStationsCompleted() && !p.redeemed ? "block" : "none";
}


</script>

</body>
</html>
